=head1 Inbox Methods

These methods are accessible via the C</inbox> URL.


=head2 view_inbox ( session_id, [ options ] )

Displays a list of the messages in the empire's inbox. Displays 25 messages per page, sorted newest to oldest.

 {
    "messages" : [
        {
            "id" : "id-goes-here",
            "subject" : "Vaxaslim",
            "date" : "01 31 2010 13:09:05 +0600",
            "from" : "Dr. Stephen T. Colbert DFA",
            "to" : "Jon Stewart",
            "has_read" : 1,
            "has_replied" : 0,
            "body_preview" : "Just a reminder that Vaxaslim ",
            "tags" : "Correspondence" 
        }
    ],
    "message_count" : 14,
    "status" : { ... }
 }

The C<tags> section allows the user to filter the messages. You can do this either client side or server side. Available tags are:

=over

=item Tutorial

Messages that come from the tutorial system.

=item Correspondence

Messages that are generated by other players, including the tutorial system.

=item Medal

Messages that let you know you've earned a medal.

=item Intelligence

Reports gathered from spies.

=item Alert

Messages letting you know something dire about your empire, usually sabotage by spies.

=back
 
Throws 1002, 1006.

=head3 session_id

A session id.

=head3 options

A hash reference of extra options.

=head4 page_number

An integer representing which page of the inbox you'd like to view. Defaults to C<1>.

=head4 tags

An array reference of tags. Only messages containing these tags will be displayed in the results.


=head2 view_archived ( session_id, [ page_number ])

Exactly the same as C<view_inbox> except that it shows archived messages instead.


=head2 view_sent ( session_id, [page_number] )

Exactly the same as C<view_inbox> except that it shows sent messages instead.




=head2 read_message ( session_id, message_id )

Retrieves a message. Marks it read if it hasn't been already.

 {
    "message" : {
        "id" : "id-goes-here",
        "from" : "Dr. Stephen T. Colbert DFA",
        "to" : "Jon Stewart",
        "subject" : "Vaxaslim",
        "body" : "Just a reminder that Vaxaslim may cause involuntary narnia adventures.",
        "date" : "01 31 2010 13:09:05 +0600",
        "has_read" : 1,
        "has_replied" : 0,
        "has_archived" : 0,
        "in_reply_to" : "",
        "recipients" : ["John Stewart"],
        "tags" : ["Correspondence"],
        "attachments" : { # no more than one of each type per email
            "image" : {
                "url" : "http://www.example.com/path/image.jpg",
                "title" : "Some Title",
                "link" : "http://www.lacunaexpanse.com/", # optional link to somewhere
            "link" : {
                "url" : "http://www.lacunaexpanse.com/",
                "label" : "The Lacuna Expanse Website"
            }
            "table" : [
                [ "Hostname", "IP Address" ], # first row is always a header
                [ "example.lacunaexpanse.com", "192.168.1.24" ],
                ...
            ],
            "map" : {
                "surface" : "surface-6",
                "buildings" : [
                    {
                        "x" : -3,
                        "y" : 4,
                        "image" : "apples4"
                    }
                    ...
                ]
            }
        }
    },
    status  => { ... }
 }
 
C<recipients> is the complete list of users who received the message, whereas C<to> is the user that owns this particular copy of the message.
 
Throws 1002, 1006, 1010.

=head3 session_id

A session id.

=head3 message_id

A message_id that was returned using C<view_inbox> or one of the other view_ methods.




=head2 archive_messages ( session_id, message_ids )
 
Archives a list of messages. Returns:

 {
    "success" : ["id-goes-here","id-goes-here"],
    "failure" : ["id-goes-here","id-goes-here"],
    "status" : { ... }
 }

B<NOTE:> You cannot archive sent messages. You'll get a failure if the message is either already archived, or it's a message that cannot be archived, like a message in your sent folder.

=head3 session_id

A session id.

=head3 message_ids

An array reference of message ids.





=head2 send_message ( session_id, recipients, subject, body, [ options ] )

Sends a message to other players. 

Throws 1002, 1005, 1006.

=head3 session_id

A session id.

=head3 recipients

A comma separated string of empire names. In addition to an empire name, C<@ally> is available as a shortcut to send to all members of an alliance.

B<NOTE:> You may want to expose a search option here using L<Empire/"find">.

=head3 subject

A subject for the message. It cannot contain any special characters, and must be less than 100 characters in length, and cannot contain &, @, ;, <, or >.

=head3 body

The body of the message. It cannot contain any special characters, and must be less than 200,000 characters in length, and cannot contain < or >.

=head3 options

A hash reference of extra options.

=head4 in_reply_to

If this message is in reply to another message, then set this option to the message id of the original message.
 
=cut